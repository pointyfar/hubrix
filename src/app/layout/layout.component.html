<mat-toolbar class="header" fxFlexLayout="row">
  <span fxFlex="auto"><img src="{{assetsBasePath}}img/hubrix-h.png" style="height:50px; margin-right: 1rem;"></span>
  <span fxFlex="auto">HUBRIX: A Hugo Site Config Builder</span>
  <span fxFlex="flex"></span>
  <span fxFlex="auto">
    <button mat-raised-button color="primary" (click)="generateConfig()">Generate Config</button>
  </span>
  
</mat-toolbar>

<mat-sidenav-container>
  <mat-sidenav #sidenav mode="side" opened 
               fixedInViewport="false" fixedTopGap="0"
               fixedBottomGap="0">
    <div class="sidenav">
      <!-------------- CONFIG LIST ----------------->
      <h2>General Hugo Config</h2>
      <mat-accordion>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              Expand config options
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div *ngIf="configFilesDone">
            <div *ngFor="let confile of configFiles" >
              <hg-config-item [configFile]="confile" (result)="setConfigValue($event)"></hg-config-item>
            </div>
          </div>
          
        </mat-expansion-panel>
      </mat-accordion>
      
      <!-------------- WIDGETS LIST ----------------->
      <h2>Widgets</h2>
      
      <div *ngIf="isReady">
      <ng-template ngFor let-wid [ngForOf]="groupedWidgets" let-i="index" [ngForTrackBy]="trackByFn">
      <mat-accordion>
        <mat-expansion-panel expanded="true">
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{wid.group}}
            </mat-panel-title>
          </mat-expansion-panel-header>
          
          <div class="ngx-dnd-container widget-list"
              ngxDroppable="widgetlist"
              [model]="wid.items"
              copy="true"
              >
            <div class="ngx-dnd-item widget-list-item"
              *ngFor="let item of wid.items"
              [ngxDraggable]="item.draggable"
              [model]="item"
              >
              <div class="widget-icon">
                <div *ngIf="item.svg; else elseIconBlock">
                  <img attr.src="{{item.svg}}">
                </div>
                <ng-template #elseIconBlock>
                  <div><i class="{{item.icon}}"></i></div>
                </ng-template>
              </div>
                
                <div class="widget-item">{{item.label}}</div>
            </div>
          </div>
        </mat-expansion-panel>
        
        
      </mat-accordion>
      </ng-template>
      </div>
    </div>
  </mat-sidenav>

  <mat-sidenav-content >
<!--    <div><pre>
      {{ config | json }}
    </pre></div>-->
    <mat-card class="main-drop">
      <mat-card-title>
        <div class="title-text">Drag widgets here</div>
        <div class="title-button">
          <button mat-raised-button color="primary" (click)="printWidgets()">
            <mat-icon>help</mat-icon>
          </button>
        </div>
      </mat-card-title>
      <mat-card-content>	
        <div class="main-section main-drop-area">
          <div *ngIf="mainSection?.length == 0 && helpText" class="main-section-help">
            <markdown ngPreserveWhitespaces>
              {{ helpText }}
            </markdown>
          </div>
      
      <div class="ngx-dnd-container row-container"
          ngxDroppable="maindroppable"
          [model]="mainSection"
          removeOnSpill="true"
          
          >
          <!-- --------------- ROWS --------------- -->
        <div class="ngx-dnd-item row-item"
          *ngFor="let row of mainSection; let i = index"
          ngxDraggable="['maindroppable']"
          [model]="row"
          >
          <!-- --------------- ROW LABELS --------------- -->
          <div class="section-label">
            <div class="label">
              <span *ngIf="row.removeable" ngxDragHandle><i class="fas fa-grip-vertical"></i></span>
              <span *ngIf="!row.removeable" ngxDragHandle></span>
              <div class="label-text">{{row.label}} // i </div>
            </div>
            <div class="settings">
              <button mat-button (click)="getContainerConfig($event, row)"><i class="fas fa-cog"></i></button>
              <button *ngIf="row.removeable" mat-button color="warn" (click)="removeFromLayout($event, i, false, false)"><i class="fas fa-trash-alt"></i></button>
            </div>
          </div>
          <!-- --------------- END ROW LABELS --------------- -->
          
          <!-- --------------- ROW COLS --------------- -->
          <div class="ngx-dnd-container"
              ngxDroppable="rowdrop"
              [model]="row.children"
              
              >  
              <div class="ngx-dnd-item {{col.class}}"
                *ngFor="let col of row.children; let j = index"
                ngxDraggable="['disabledrag']"
                [model]="col"
                >
                
                <!-- --------------- CONTENTS --------------- -->
                <div class="ngx-dnd-container"
                    ngxDroppable="contents" 
                    [model]="col.children"
                    removeOnSpill="true"
                    
                    >  
                    <div class="ngx-dnd-item widget-item"
                      *ngFor="let item of col.children; let k = index"
                      ngxDraggable="['contents']"
                      [model]="item"
                      >
                      <!-- --------------- WIDGET LABELS --------------- -->
                      <div class="section-label">
                        <div class="label">
                          <span ngxDragHandle><i class="fas fa-grip-vertical"></i></span>
                          <div class="label-text">{{item.label}}</div>
                        </div>
                      </div>
                      <!-- --------------- END WIDGET LABELS --------------- -->
                      <hg-widget  
                        [image]="item.image"
                        [contentUrl]="item.content"
                        [qpath]="item.formConfig" 
                        [title]="item.label"  
                        (widgetConfig)="attachConfig($event, item)" 
                        (removeWidget)="removeFromLayout($event, i, j, k)"
                        >
                      </hg-widget>
                    </div>
                </div>
                <!-- --------------- END CONTENTS --------------- -->
                
              </div>
          </div>
          <!-- --------------- END ROW COLS --------------- -->
          
            
        </div>
        <!-- --------------- END ROWS --------------- -->
        
      </div>
      

        </div>
    </mat-card-content>	
    </mat-card>
    
  </mat-sidenav-content>
</mat-sidenav-container>
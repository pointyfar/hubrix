<mat-toolbar class="header" fxFlexLayout="row">
  <span fxFlex="auto"><img src="{{assetsBasePath}}img/hubrix-h.png" style="height:50px; margin-right: 1rem;"></span>
  <span fxFlex="auto">HUBRIX: A Hugo Site Config Builder</span>
  <span fxFlex="flex"></span>
  <span fxFlex="auto">
    <button mat-raised-button color="primary" (click)="generateConfig()">Generate Config</button>
  </span>
  
</mat-toolbar>

<mat-sidenav-container>
  <mat-sidenav #sidenav mode="side" opened 
               fixedInViewport="false" fixedTopGap="0"
               fixedBottomGap="0">
    <div class="sidenav">
      <h2>Widgets</h2>
      
      <div *ngIf="isReady">
      <ng-template ngFor let-wid [ngForOf]="groupedWidgets" let-i="index" [ngForTrackBy]="trackByFn">
      <mat-accordion>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>
              {{wid.group}}
            </mat-panel-title>
          </mat-expansion-panel-header>

             <ngx-dnd-container
               class="widget-list"
               [model]="wid.items"
               [dropZones]="['builder-target']"
               [copy]="true"
               [droppableItemClass]="droppableItemClass"
               >
               <ng-template let-item="model">
                 <mat-icon>{{item.icon}}</mat-icon>
                 <div class="widget-item">{{item.label}}</div>
               </ng-template>
             </ngx-dnd-container>
        </mat-expansion-panel>
        
        
      </mat-accordion>
      </ng-template>
    </div>
    </div>
  </mat-sidenav>

  <mat-sidenav-content >
    <div class="content-header">
    <div><h2>Drag widgets here</h2></div>
    <div  class="site-config-btn">
      <button mat-raised-button color="primary" (click)="loadParamsConfigDialog()">
        General Config
      </button>
      <button mat-raised-button color="primary" (click)="loadHugoConfigDialog()">
        Hugo Config
      </button>
      <div *ngIf="siteConfigDone; else indeterminate">
        <mat-icon>check_box</mat-icon>
      </div>
      <ng-template #indeterminate>
        <div>
          <mat-icon>indeterminate_check_box</mat-icon>
        </div>
      </ng-template>
    </div>
    </div>
    <div class="main-section">
      
      <ngx-dnd-container
        class="root-container"
        [model]="mainSection"
        dropZone="builder-target"
        [removeOnSpill]="true"
        [droppableItemClass]="droppableItemClass"
        >
        <ng-template let-model="model" let-template="template">
          <div [ngSwitch]="model.inputType">
            <div *ngSwitchCase="'section'">
              
                <div class="section-label">
                  <div class="label">{{model.label}}</div>
                  <mat-icon ngxDragHandle>pan_tool</mat-icon>
                </div>
                <ngx-dnd-container
                  dropZone="builder-target"
                  [model]="model.children"
                  [removeOnSpill]="true"
                  [template]="template"
                  [droppableItemClass]="droppableItemClass"
                  >
                </ngx-dnd-container>
              
            </div>
            <div *ngSwitchCase="'content'" class="widget-container">
              <hg-widget [qpath]="model.formConfig" [title]="model.label"  (widgetConfig)="attachConfig($event, model)" ></hg-widget>
              <!--Model Data: {{model.result|json}}-->
            
              <div class="icons">
                <mat-icon ngxDragHandle>pan_tool</mat-icon>
              </div>
              
            </div>
            <div *ngSwitchDefault>
              <label>{{model.name}}</label>
              <input [attr.type]="model.inputType" [ngModel]="model.data">
            </div>
          </div>
        </ng-template>
      </ngx-dnd-container>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>